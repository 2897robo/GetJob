# ğŸ“š 2025-04-27 JPA í•™ìŠµ ì¢…í•© ì •ë¦¬

---

# 1. JPA ê¸°ë³¸ êµ¬ì¡°

## EntityManager êµ¬ì¡°
- **EntityManagerFactory ì´ˆê¸°í™”** (ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ 1ê°œ ìƒì„±)
- **DB ì‘ì—…ì´ í•„ìš”í•  ë•Œë§ˆë‹¤**
    - EntityManager ìƒì„±
    - EntityManagerë¡œ DB ì¡°ì‘
    - EntityTransactionìœ¼ë¡œ íŠ¸ëœì­ì…˜ ê´€ë¦¬

## ìŠ¤í”„ë§ê³¼ ì—°ë™ ì‹œ
- ìŠ¤í”„ë§ì´ ëŒ€ë¶€ë¶„ ì²˜ë¦¬í•¨ (EntityManagerë¥¼ ê´€ë¦¬)
- ìš°ë¦¬ëŠ” **ë§¤í•‘ ì„¤ì •**ê³¼ **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**ì— ì§‘ì¤‘

## ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸
- ì—”í‹°í‹°ë¥¼ ë©”ëª¨ë¦¬ì— ë³´ê´€í•˜ëŠ” ê°€ìƒì˜ ê³µê°„
- ë³€ê²½ì‚¬í•­ì„ ì¶”ì í•˜ì—¬ **íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì **ì— DBì— ë°˜ì˜

---

# 2. ì£¼ìš” ë§¤í•‘ ì• ë…¸í…Œì´ì…˜

| ì• ë…¸í…Œì´ì…˜ | ì„¤ëª… |
|:---|:---|
| `@Entity` | í…Œì´ë¸”ê³¼ ë§¤í•‘ë  í´ë˜ìŠ¤ ì„ ì–¸ |
| `@Table` | í…Œì´ë¸” ì´ë¦„ ì„¤ì • |
| `@Id` | ê¸°ë³¸í‚¤(PK) ì„¤ì • |
| `@Column` | ì»¬ëŸ¼ ì†ì„± ìƒì„¸ ì„¤ì • |
| `@Enumerated` | Enum íƒ€ì… ë§¤í•‘ ì„¤ì • |


## ì—”í‹°í‹° í´ë˜ìŠ¤ ì œì•½ì‚¬í•­
- ê¸°ë³¸ ìƒì„±ì í•„ìš” (`public` or `protected`)
- í•„ë“œ or ë©”ì„œë“œì—ë§Œ ë§¤í•‘ ì• ë…¸í…Œì´ì…˜ ë¶™ì—¬ì•¼ í•¨

## ì ‘ê·¼ íƒ€ì…
- **í•„ë“œ ì ‘ê·¼**(ì¶”ì²œ)
- í”„ë¡œí¼í‹°(getter/setter) ì ‘ê·¼

---

# 3. ì‹ë³„ì ìƒì„± ì „ëµ

## 3-1. ì‹œí€€ìŠ¤ë¥¼ ì‚¬ìš©í•œ ì‹ë³„ì ìƒì„±

### íŠ¹ì§•
- `persist()` í˜¸ì¶œ ì‹œ **ì‹œí€€ìŠ¤ì—ì„œ ì‹ë³„ì ì¡°íšŒ**
- INSERTëŠ” ì»¤ë°‹ ì‹œ ì‹¤í–‰

### ì„¤ì • ë°©ë²•
```java
@Entity
@Table(schema = "crm", name = "activity_log")
public class ActivityLog {
    @Id
    @SequenceGenerator(
        name = "log_seq_gen",
        sequenceName = "activity_seq",
        schema = "crm",
        allocationSize = 1
    )
    @GeneratedValue(generator = "log_seq_gen")
    private Long id;

    @Column(name = "user_id")
    private String userId;

    // ìƒì„±ì ë“±...
}
```

### íë¦„
1. ê°ì²´ ìƒì„± ì‹œ ì‹ë³„ì ì—†ìŒ
2. `persist()` ì‹œì ì— ì‹œí€€ìŠ¤ë¡œ ID ë¶€ì—¬
3. íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ INSERT ì¿¼ë¦¬ ì‹¤í–‰

---

## 3-2. IDENTITY ì „ëµ (AUTO_INCREMENT)

### íŠ¹ì§•
- `persist()` í˜¸ì¶œ ì‹œ **ë°”ë¡œ INSERT ì‹¤í–‰**
- INSERT ì™„ë£Œ í›„ ì‹ë³„ì ìƒì„±

### ì„¤ì • ë°©ë²•
```java
@Entity
public class Review {
    @Id
    @Column(name = "review_id")
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "hotel_id")
    private String hotelId;

    // ìƒì„±ì ë“±...
}
```

### íë¦„
1. ê°ì²´ ìƒì„± ì‹œ ì‹ë³„ì ì—†ìŒ
2. `persist()` ì‹œì ì— ë°”ë¡œ INSERT
3. DBê°€ ì‹ë³„ì ë¶€ì—¬

---

# 4. @Embeddable, @AttributeOverride, @SecondaryTable

## 4-1. @Embeddable (ê°’ íƒ€ì… ê°ì²´)

### ëª©ì 
- ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê°’ ê°ì²´ë¥¼ ë³„ë„ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬
- ì£¼ í…Œì´ë¸”ì— ë…¹ì—¬ì„œ ë§¤í•‘

### ì˜ˆì‹œ
```java
@Embeddable
public class Address {
    private String city;
    private String street;
    private String zipcode;
}

@Entity
public class Member {
    @Id
    @GeneratedValue
    private Long id;

    private String name;

    @Embedded
    private Address address;
}
```

**â†’ ê²°ê³¼: Member í…Œì´ë¸”ì— city, street, zipcode ì»¬ëŸ¼ ìƒì„±**

---

## 4-2. @AttributeOverride (ì»¬ëŸ¼ëª… ë³€ê²½)

### ëª©ì 
- @Embeddable íƒ€ì…ì„ ì¬ì‚¬ìš©í•˜ë©´ì„œ í•„ë“œ ì´ë¦„ì„ ë‹¤ë¥´ê²Œ ë§¤í•‘

### ì˜ˆì‹œ
```java
@Entity
public class Delivery {
    @Id
    @GeneratedValue
    private Long id;

    @Embedded
    @AttributeOverrides({
        @AttributeOverride(name = "city", column = @Column(name = "delivery_city")),
        @AttributeOverride(name = "street", column = @Column(name = "delivery_street")),
        @AttributeOverride(name = "zipcode", column = @Column(name = "delivery_zipcode"))
    })
    private Address address;
}
```

**â†’ ê²°ê³¼: Delivery í…Œì´ë¸”ì— delivery_city, delivery_street, delivery_zipcode ì»¬ëŸ¼ ìƒì„±**

---

## 4-3. @SecondaryTable (ë³´ì¡° í…Œì´ë¸” ë§¤í•‘)

### ëª©ì 
- í•˜ë‚˜ì˜ ì—”í‹°í‹°ë¥¼ ë‘ ê°œ ì´ìƒì˜ í…Œì´ë¸”ì— ë¶„ì‚° ì €ì¥

### ì˜ˆì‹œ
```java
@Entity
@SecondaryTable(name = "member_detail", 
    pkJoinColumns = @PrimaryKeyJoinColumn(name = "member_id"))
public class Member {
    @Id
    @GeneratedValue
    private Long id;

    private String name;

    @Column(table = "member_detail")
    private String phoneNumber;

    @Column(table = "member_detail")
    private String address;
}
```

**â†’ ê²°ê³¼: ê¸°ë³¸ì •ë³´ëŠ” member í…Œì´ë¸”, ìƒì„¸ì •ë³´ëŠ” member_detail í…Œì´ë¸”ì— ì €ì¥**

---

# ğŸ“Œ ì˜¤ëŠ˜ í•™ìŠµ í•µì‹¬ ìš”ì•½

- JPAëŠ” EntityManagerì™€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¡œ DBë¥¼ ê´€ë¦¬í•œë‹¤.
- ì‹ë³„ì ìƒì„± ì „ëµì—ëŠ” ì‹œí€€ìŠ¤ ì „ëµê³¼ IDENTITY ì „ëµì´ ìˆë‹¤.
- @Embeddable, @AttributeOverride, @SecondaryTableì„ í†µí•´ ê°’ ê°ì²´ ë§¤í•‘ê³¼ í…Œì´ë¸” ë¶„ì‚° ì €ì¥ì´ ê°€ëŠ¥í•˜ë‹¤.

---

# âœ¨ ì¶”ê°€ë¡œ ê¸°ì–µí•  ì 

- ì‹œí€€ìŠ¤ ì „ëµì€ **persist() ì‹œì ì— ID í™•ë³´ â†’ ì»¤ë°‹ ë•Œ INSERT**
- IDENTITY ì „ëµì€ **persist() ì‹œì ì— ë°”ë¡œ INSERT**
- ì‹¤ë¬´ì—ì„œëŠ” ìƒí™©ì— ë§ì¶° ì‹ë³„ì ì „ëµì„ ì„ íƒí•  ê²ƒ!
- ê³µí†µ ê°’ ê°ì²´ëŠ” @Embeddableë¡œ ê´€ë¦¬í•˜ë©´ ì½”ë“œ ê¹”ë”í•´ì§
